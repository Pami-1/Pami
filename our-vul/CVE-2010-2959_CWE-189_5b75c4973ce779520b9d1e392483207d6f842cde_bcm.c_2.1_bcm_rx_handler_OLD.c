static void bcm_rx_handler(struct sk_buff *skb, void *data)
{
	struct bcm_op *op = (struct bcm_op *)data;
	const struct can_frame *rxframe = (struct can_frame *)skb->data;
	int i;

	
	hrtimer_cancel(&op->timer);

	if (op->can_id != rxframe->can_id)
		return;

	
	op->rx_stamp = skb->tstamp;
	
	op->rx_ifindex = skb->dev->ifindex;
	
	op->frames_abs++;

	if (op->flags & RX_RTR_FRAME) {
		
		bcm_can_tx(op);
		return;
	}

	if (op->flags & RX_FILTER_ID) {
		
		bcm_rx_update_and_send(op, &op->last_frames[0], rxframe);
		goto rx_starttimer;
	}

	if (op->nframes == 1) {
		
		bcm_rx_cmp_to_index(op, 0, rxframe);
		goto rx_starttimer;
	}

	if (op->nframes > 1) {
		






		for (i = 1; i < op->nframes; i++) {
			if ((GET_U64(&op->frames[0]) & GET_U64(rxframe)) ==
			    (GET_U64(&op->frames[0]) &
			     GET_U64(&op->frames[i]))) {
				bcm_rx_cmp_to_index(op, i, rxframe);
				break;
			}
		}
	}

rx_starttimer:
	bcm_rx_starttimer(op);
}