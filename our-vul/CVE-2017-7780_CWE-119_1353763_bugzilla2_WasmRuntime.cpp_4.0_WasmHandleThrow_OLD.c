static WasmActivation*
WasmHandleThrow()
{
    JSContext* cx = TlsContext.get();

    WasmActivation* activation = cx->wasmActivationStack();
    MOZ_ASSERT(activation);

    
    
    
    
    
    
    
    FrameIterator iter(activation, FrameIterator::Unwind::True);
    if (iter.done())
        return activation;

    
    
    
    
    
    
    
    
    RootedWasmInstanceObject keepAlive(cx, iter.instance()->object());

    for (; !iter.done(); ++iter) {
        if (!iter.debugEnabled())
            continue;

        DebugFrame* frame = iter.debugFrame();
        frame->clearReturnJSValue();

        
        
        if (cx->isExceptionPending()) {
            JSTrapStatus status = Debugger::onExceptionUnwind(cx, frame);
            if (status == JSTRAP_RETURN) {
                
                
                
                JS_ReportErrorASCII(cx, "Unexpected resumption value from onExceptionUnwind");
            }
        }

        bool ok = Debugger::onLeaveFrame(cx, frame, nullptr, false);
        if (ok) {
            
            
            
            JS_ReportErrorASCII(cx, "Unexpected success from onLeaveFrame");
        }
        frame->leave(cx);
     }

    return activation;
}