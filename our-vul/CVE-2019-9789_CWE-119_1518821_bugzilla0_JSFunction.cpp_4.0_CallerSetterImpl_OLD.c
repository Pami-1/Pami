bool CallerSetterImpl(JSContext* cx, const CallArgs& args) {
  MOZ_ASSERT(IsFunction(args.thisv()));

  
  
  
  
  RootedFunction fun(cx, &args.thisv().toObject().as<JSFunction>());
  if (!CallerRestrictions(cx, fun)) {
    return false;
  }

  
  args.rval().setUndefined();

  
  
  
  

  NonBuiltinScriptFrameIter iter(cx);
  if (!AdvanceToActiveCallLinear(cx, iter, fun)) {
    return true;
  }

  ++iter;
  while (!iter.done() && iter.isEvalFrame()) {
    ++iter;
  }

  if (iter.done() || !iter.isFunctionFrame()) {
    return true;
  }

  RootedObject caller(cx, iter.callee(cx));
  
  
  
  
  if (!cx->compartment()->wrap(cx, &caller)) {
    cx->clearPendingException();
    return true;
  }

  
  
  JSObject* callerObj = CheckedUnwrap(caller);
  if (!callerObj) {
    return true;
  }

  JSFunction* callerFun = &callerObj->as<JSFunction>();
  MOZ_ASSERT(!callerFun->isBuiltin(),
             "non-builtin iterator returned a builtin?");

  if (callerFun->strict()) {
    JS_ReportErrorNumberASCII(cx, GetErrorMessage, nullptr,
                              JSMSG_CALLER_IS_STRICT);
    return false;
  }

  return true;
}