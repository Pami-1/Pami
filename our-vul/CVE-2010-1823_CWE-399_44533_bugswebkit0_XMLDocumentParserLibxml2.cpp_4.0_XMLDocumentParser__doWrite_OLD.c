void XMLDocumentParser::doWrite(const String& parseString)
{
    if (!m_context)
        initializeParserContext();

    
    RefPtr<XMLParserContext> context = m_context;

    
    if (parseString.length()) {
        
        
        
        
        const UChar BOM = 0xFEFF;
        const unsigned char BOMHighByte = *reinterpret_cast<const unsigned char*>(&BOM);
        xmlSwitchEncoding(context->context(), BOMHighByte == 0xFF ? XML_CHAR_ENCODING_UTF16LE : XML_CHAR_ENCODING_UTF16BE);

        XMLDocumentParserScope scope(document()->docLoader());
        xmlParseChunk(context->context(), reinterpret_cast<const char*>(parseString.characters()), sizeof(UChar) * parseString.length(), 0);
    }

    if (document()->decoder() && document()->decoder()->sawError()) {
        
        handleError(fatal, "Encoding error", context->context()->input->line, context->context()->input->col);
    }

    return;
}