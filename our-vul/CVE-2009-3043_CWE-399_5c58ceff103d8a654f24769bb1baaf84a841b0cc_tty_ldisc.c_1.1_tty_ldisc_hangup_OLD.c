void tty_ldisc_hangup(struct tty_struct *tty)
{
	struct tty_ldisc *ld;

	




	ld = tty_ldisc_ref(tty);
	if (ld != NULL) {
		
		if (ld->ops->flush_buffer)
			ld->ops->flush_buffer(tty);
		tty_driver_flush_buffer(tty);
		if ((test_bit(TTY_DO_WRITE_WAKEUP, &tty->flags)) &&
		    ld->ops->write_wakeup)
			ld->ops->write_wakeup(tty);
		if (ld->ops->hangup)
			ld->ops->hangup(tty);
		tty_ldisc_deref(ld);
	}
	



	wake_up_interruptible_poll(&tty->write_wait, POLLOUT);
	wake_up_interruptible_poll(&tty->read_wait, POLLIN);
	



	if (tty->driver->flags & TTY_DRIVER_RESET_TERMIOS) {
		
		mutex_lock(&tty->ldisc_mutex);
		if (tty->ldisc) {	
			
			tty_ldisc_halt(tty);
			tty_ldisc_reinit(tty);
			



			WARN_ON(tty_ldisc_open(tty, tty->ldisc));
			tty_ldisc_enable(tty);
		}
		mutex_unlock(&tty->ldisc_mutex);
		tty_reset_termios(tty);
	}
}