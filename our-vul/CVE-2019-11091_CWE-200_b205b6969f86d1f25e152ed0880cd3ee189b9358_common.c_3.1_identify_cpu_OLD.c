void identify_cpu(struct cpuinfo_x86 *c)
{
	int i;

	c->x86_cache_size = -1;
	c->x86_vendor = X86_VENDOR_UNKNOWN;
	c->cpuid_level = -1;	
	c->x86_model = c->x86_mask = 0;	
	c->x86_vendor_id[0] = '\0'; 
	c->x86_model_id[0] = '\0';  
	c->x86_max_cores = 1;
	c->x86_num_siblings = 1;
	c->x86_clflush_size = 0;
	c->phys_proc_id = XEN_INVALID_SOCKET_ID;
	c->cpu_core_id = XEN_INVALID_CORE_ID;
	c->compute_unit_id = INVALID_CUID;
	memset(&c->x86_capability, 0, sizeof c->x86_capability);

	generic_identify(c);

#ifdef NOISY_CAPS
	printk(KERN_DEBUG "CPU: After vendor identify, caps:");
	for (i = 0; i < NCAPINTS; i++)
		printk(" %08x", c->x86_capability[i]);
	printk("\n");
#endif

	









	if (this_cpu->c_init)
		this_cpu->c_init(c);


   	if ( !opt_pku )
		setup_clear_cpu_cap(X86_FEATURE_PKU);

	



	for (i = 0; i < FSCAPINTS; ++i)
		c->x86_capability[i] &= known_features[i];

	for (i = 0 ; i < NCAPINTS ; ++i)
		c->x86_capability[i] &= ~cleared_caps[i];

	
	if ( !c->x86_model_id[0] ) {
		
		snprintf(c->x86_model_id, sizeof(c->x86_model_id),
			"%02x/%02x", c->x86_vendor, c->x86_model);
	}

	

	if ( cpu_has_xsave )
		xstate_init(c);

#ifdef NOISY_CAPS
	printk(KERN_DEBUG "CPU: After all inits, caps:");
	for (i = 0; i < NCAPINTS; i++)
		printk(" %08x", c->x86_capability[i]);
	printk("\n");
#endif

	





	if ( c != &boot_cpu_data ) {
		
		if (test_bit(X86_FEATURE_IND_THUNK_LFENCE,
		             boot_cpu_data.x86_capability))
			__set_bit(X86_FEATURE_IND_THUNK_LFENCE,
			          c->x86_capability);
		if (test_bit(X86_FEATURE_IND_THUNK_JMP,
			     boot_cpu_data.x86_capability))
			__set_bit(X86_FEATURE_IND_THUNK_JMP, c->x86_capability);
		if (test_bit(X86_FEATURE_SC_MSR_PV,
		             boot_cpu_data.x86_capability))
			__set_bit(X86_FEATURE_SC_MSR_PV, c->x86_capability);
		if (test_bit(X86_FEATURE_SC_MSR_HVM,
		             boot_cpu_data.x86_capability))
			__set_bit(X86_FEATURE_SC_MSR_HVM, c->x86_capability);
		if (test_bit(X86_FEATURE_SC_RSB_PV,
		             boot_cpu_data.x86_capability))
			__set_bit(X86_FEATURE_SC_RSB_PV, c->x86_capability);
		if (test_bit(X86_FEATURE_SC_RSB_HVM,
		             boot_cpu_data.x86_capability))
			__set_bit(X86_FEATURE_SC_RSB_HVM, c->x86_capability);
		if (test_bit(X86_FEATURE_NO_XPTI,
		             boot_cpu_data.x86_capability))
			__set_bit(X86_FEATURE_NO_XPTI, c->x86_capability);
		if (test_bit(X86_FEATURE_SC_MSR_IDLE,
			     boot_cpu_data.x86_capability))
			__set_bit(X86_FEATURE_SC_MSR_IDLE, c->x86_capability);

		
		for ( i = 0 ; i < NCAPINTS ; i++ )
			boot_cpu_data.x86_capability[i] &= c->x86_capability[i];

		mcheck_init(c, 0);
	} else {
		mcheck_init(c, 1);

		mtrr_bp_init();
	}
}